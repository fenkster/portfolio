---
title: "compmusic"
author: "fenk"
date: "Spring 2021"
output:
  flexdashboard::flex_dashboard:
    storyboard: true
    theme: flatly
---
```{r}
library(tidyverse)
library(spotifyr)
library(compmus)
library(plotly)
```

### Introduction: West v.s. East Coast Hip-Hop
My corpus consists of different playlists representing two different genres of hiphop; west coast and east coast rap. These styles of hiphop derive from the east vs west coast rivalry from the mid 1990s. The four playlists I have curated represent different eras' of west/east coast music. They will allow me to uncover the musicological differences in these styles. I have two playlists for both types of west and east coast hiphop. One from its native time period, the mid 1990s as well as from today. Comparing modern and old school east and west coast rap will hopefully result in interesting findings. The production and beats of each of these genre's differs and I hope my research will help produce some answers in a more a data orientated and technical sense.

The playlists in question:

East Coast:

-I love my East Coast classics (https://open.spotify.com/playlist/37i9dQZF1DWYGxBNe4qojI?si=Vnk0_2JORM6iL9ZK687ohQ)

-State of Mind (https://open.spotify.com/playlist/37i9dQZF1DX1YPTAhwehsC?si=qaVXWuBySnWcegc6X_q0ug)

West Coast:

-I love my West Coast classics (https://open.spotify.com/playlist/37i9dQZF1DX9sQDbOMReFI?si=vn1s69TjRxqx43Kc62lVxA)

-Cali Fire (https://open.spotify.com/playlist/3X0Ds1IEYdG1DL0sxCuW6y?si=-G0PuulVTFGmY2oaP490Ag)

East Coast hiphop carries a more aggressive sound, while West Coast hip-hop is more laid back. East Coast natives are Jay Z, Notorious BIG, Nas, Rakim, Run DMC, KRS One. West Coast hiphop is mainly for chilling out and partying. Notable artists include The Game, 2Pac Shakur, Snoop Dogg, Grandmaster Flash. The west coast scene also popularized g-funk, a fusion between hip-hop and funk music. Some artists might have elements that are more similar to one genre vs the other. It will be interesting to see who has influenced who? Whether this was identified mainly through vocals or production.

### West vs East Coast 
```{r}
west <- get_playlist_audio_features("", "37i9dQZF1DX9sQDbOMReFI")
#west <- get_playlist_audio_features("", "6dv5FbNRVlQelteqnNDFTe")
#east <- get_playlist_audio_features("", "67zYW4wCQezR6AH8EuNZ1Q")
east <- get_playlist_audio_features("", "37i9dQZF1DWYGxBNe4qojI")

west_new <- get_playlist_audio_features("", "3X0Ds1IEYdG1DL0sxCuW6y")
east_new <- get_playlist_audio_features("", "37i9dQZF1DX1YPTAhwehsC")
```


> Energy
```{r}
sprintf("East Coast Classics: %s. Its energy: %f",east$track.name[which.max(east$energy)],max(east$energy))
sprintf("West Coast Classics: %s. Its energy: %f", west$track.name[which.max(west$energy)],max(west$energy))
sprintf("East Coast Modern: %s. Its energy: %f",east_new$track.name[which.max(east_new$energy)],max(na.omit(east_new$energy)))
sprintf("West Coast Modern: %s. Its energy: %f",west_new$track.name[which.max(west_new$energy)],max(west_new$energy))

sprintf("East Coast Classics: %f",mean(east$energy))
sprintf("West Coast Classics: %f", mean(west$energy))
sprintf("East Coast Modern: %f", mean(na.omit(east_new$energy)))
sprintf("West Coast Modern: %f",mean(west_new$energy))
```
> Loudness
```{r}
sprintf("East Coast Classics: %s. Its loudness: %f",east$track.name[which.max(east$loudness)],max(east$loudness))
sprintf("West Coast Classics: %s. Its loudness: %f", west$track.name[which.max(west$loudness)],max(west$loudness))
sprintf("East Coast Modern: %s. Its loudness: %f",east_new$track.name[which.max(east_new$loudness)],max(na.omit(east_new$loudness)))
sprintf("West Coast Modern: %s. Its loudness: %f",west_new$track.name[which.max(west_new$loudness)],max(west_new$loudness))

sprintf("East Coast Classics: %f",mean(east$loudness))
sprintf("West Coast Classics: %f", mean(west$loudness))
sprintf("East Coast Modern: %f", mean(na.omit(east_new$loudness)))
sprintf("West Coast Modern: %f",mean(west_new$loudness))
```

### Variables
```{r}
west_summary <- west %>%
  summarise(
    mean_popularity = mean(track.popularity),
    mean_danceability = mean(danceability),
    mean_valence = mean(valence),
    mean_energy = mean(energy),
    mean_acousticness = mean(acousticness),
  )
west_summary
```

```{r}
east_summary <- east %>%
  summarise(
    mean_popularity = mean(track.popularity),
    mean_danceability = mean(danceability),
    mean_valence = mean(valence),
    mean_energy = mean(energy),
    mean_acousticness = mean(acousticness),
  )
east_summary
```

### ggplot histogram
#### west v.s. east
```{r}
together <-
  bind_rows(
    west %>% mutate(category = "West Coast Classics"),
    east %>% mutate(category = "East Coast Classics"),
    west_new %>% mutate(category = "West Coast Modern"),
    east_new %>% mutate(category = "East Coast Modern")
  )
```

```{r}
west %>% ggplot(aes(x =valence)) + geom_histogram(binwidth = 0.05)
```

```{r}
east %>% ggplot(aes(x = valence)) + geom_histogram(binwidth = 0.05)
```

### Comprehensive Visualisation
#### Old School West & East Coast classics v.s. Modern West & East Coast music

```{r}
together %>%                    
  mutate(
    mode = ifelse(mode == 0, "Minor", "Major")
  ) %>%
  ggplot(                     # Set up the plot.
    aes(
      x = valence,
      y = energy,
      size = loudness,
      colour = mode
    )
  ) + geom_point() +              # Scatter plot.
  #geom_rug(size = 0.1) +      # Add 'fringes' to show data distribution.
  # geom_text(                  # Add text labels from above.
  #   aes(
  #     x = valence,
  #     y = energy,
  #     label = label
  #   ),
  #   data = 
  #     tibble(
  #       label = c("Altijd wel iemand", "ENERGY"),
  #       category = c("00s", "70s"),
  #       valence = c(0.090, 0.123),
  #       energy = c(0.101, 0.967)
  #     ),
  #   colour = "black",         # Override colour (not mode here).
  #   size = 3,                 # Override size (not loudness here).
  #   hjust = "left",           # Align left side of label with the point.
  #   vjust = "bottom",         # Align bottom of label with the point.
  #   nudge_x = -0.05,          # Nudge the label slightly left.
  #   nudge_y = 0.02            # Nudge the label slightly up.
  # ) +
  facet_wrap(~category) +     # Separate charts per playlist.
  scale_x_continuous(         # Fine-tune the x axis.
    limits = c(0, 1),
    breaks = c(0, 0.50, 1),   # Use grid-lines for quadrants only.
    minor_breaks = NULL       # Remove 'minor' grid-lines.
  ) +
  scale_y_continuous(         # Fine-tune the y axis in the same way.
    limits = c(0, 1),
    breaks = c(0, 0.50, 1),
    minor_breaks = NULL
  ) +
  scale_colour_brewer(        # Use the Color Brewer to choose a palette.
    type = "qual",            # Qualitative set.
    palette = "Paired",  # Name of the palette is 'Paired'.
    ) +
  scale_size_continuous(      # Fine-tune the sizes of each point.
     trans = "exp",            # Use an exp transformation to emphasise loud.
     #guide = "none"            # Remove the legend for size.
  ) +
  theme_light() +             # Use a simpler theme.
  labs(                       # Make the titles nice.
    x = "Valence",
    y = "Energy",
    colour = "Mode",
    size="Loudness"
  )
```

***
These charts displays four important metrics for each playlist in my corpus. We compare valence, energy, loudness and mode in this comprehensive visualization.

### Modality comparison
#### Old School West & East Coast classics v.s. Modern West & East Coast music

```{r}
together %>% ggplot(aes(x = mode)) + geom_histogram(binwidth = 0.05)+facet_wrap(~category)
```

> Mode indicates the modality (major or minor) of a track. Major is represented by 1 and minor is 0.

### Loudest Songs from the East Coast
```{r}
loudesteast <-
  get_tidy_audio_analysis("4jCio4LNO1eZbl09ed4ZFn") %>%
  select(segments) %>%
  unnest(segments) %>%
  select(start, duration, pitches)
```

```{r}
loudesteast %>%
  mutate(pitches = map(pitches, compmus_normalise, "manhattan")) %>%
  compmus_gather_chroma() %>% 
  ggplot(
    aes(
      x = start + duration / 2,
      width = duration,
      y = pitch_class,
      fill = value
    )
  ) +
  geom_tile() +
  labs(x = "Time (s)", y = NULL, fill = "Magnitude") +
  theme_minimal() +
  scale_fill_viridis_c()
```

```{r}
loudesteast_new <-
  get_tidy_audio_analysis("6eQHIFVNvgsg4ooRrzgwVz") %>%
  select(segments) %>%
  unnest(segments) %>%
  select(start, duration, pitches)
```

```{r}
loudesteast_new %>%
  mutate(pitches = map(pitches, compmus_normalise, "manhattan")) %>%
  compmus_gather_chroma() %>% 
  ggplot(
    aes(
      x = start + duration / 2,
      width = duration,
      y = pitch_class,
      fill = value
    )
  ) +
  geom_tile() +
  labs(x = "Time (s)", y = NULL, fill = "Magnitude") +
  theme_minimal() +
  scale_fill_viridis_c()
```

### Loudest Songs from the West Coast
```{r}
loudestwest <-
  get_tidy_audio_analysis("3ssX20QT5c3nA9wk78V1LQ") %>%
  select(segments) %>%
  unnest(segments) %>%
  select(start, duration, pitches)
```

```{r}
loudestwest %>%
  mutate(pitches = map(pitches, compmus_normalise, "manhattan")) %>%
  compmus_gather_chroma() %>% 
  ggplot(
    aes(
      x = start + duration / 2,
      width = duration,
      y = pitch_class,
      fill = value
    )
  ) +
  geom_tile() +
  labs(x = "Time (s)", y = NULL, fill = "Magnitude") +
  theme_minimal() +
  scale_fill_viridis_c()
```

```{r}
loudestwest_new <-
  get_tidy_audio_analysis("3yh3vAhcfQQfOmqSq6SEJj") %>%
  select(segments) %>%
  unnest(segments) %>%
  select(start, duration, pitches)
```

```{r}
loudestwest_new %>%
  mutate(pitches = map(pitches, compmus_normalise, "manhattan")) %>%
  compmus_gather_chroma() %>% 
  ggplot(
    aes(
      x = start + duration / 2,
      width = duration,
      y = pitch_class,
      fill = value
    )
  ) +
  geom_tile() +
  labs(x = "Time (s)", y = NULL, fill = "Magnitude") +
  theme_minimal() +
  scale_fill_viridis_c()
```
### Conclusion: Discussion of findings


Blah blah

***